name: LLM Quality & Safety Monitor CI

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        echo "üß™ Running LLM Quality & Safety monitoring tests..."
        python -m pytest tests/ -v
    
    - name: Test API server
      run: |
        echo "üöÄ Testing API server startup..."
        python -c "
        import sys
        try:
            from api.server import app
            print('‚úÖ API server imports successfully')
            print(f'‚úÖ API has {len(app.routes)} routes configured')
        except Exception as e:
            print(f'‚ùå API server test failed: {e}')
            sys.exit(1)
        "
    
    - name: Validate monitoring components
      run: |
        echo "üìä Validating monitoring components..."
        python -c "
        import sys
        try:
            from monitoring.models import LLMTrace, QualityMetrics, SafetyAssessment, CostMetrics
            from monitoring.quality import QualityMonitor
            from monitoring.cost import CostTracker
            print('‚úÖ All monitoring components import successfully')
        except Exception as e:
            print(f'‚ùå Component validation failed: {e}')
            sys.exit(1)
        " 